---
title: "Naissance"
author: "Eagle IO"
date: "1/14/2021"
output: pdf_document
---

```{r,echo=FALSE,include=FALSE}
library(readxl)
library(tidyverse)
library(stringr)
library(psych)
library(caret)
library(ggplot2)
library(car)
library(ggthemes)
library(plyr)
library(scales)
library(zoo)
library(descr)
library(dplyr)
library(tidymodels)
library(class)
library(kknn)
library(janitor)
library(CGPfunctions)
library(summarytools)
library(ggpubr)

# Remember to change the location to your computer or flashdrive. 
data <- read_excel("E:/Montclair State University/EagleIO/Naissance/Naissance e-Mail Metrics Pilot - Data Template.xlsx")
```

```{r, include=FALSE}
Date<-as.data.frame(substr(data$`Send Time`,1,10))
Time<-as.data.frame(substr(data$`Send Time`,12,19))

#Rename Days and Time


Date<-Date%>%rename(date="substr(data$`Send Time`, 1, 10)")
Time<-Time%>%rename(time="substr(data$`Send Time`, 12, 19)")

Date$date<-gsub("2021","2020",Date$date)

# Creating Days
Date2<-as.data.frame(weekdays(as.Date(Date$date,'%Y-%m-%d')))
Date2<-Date2%>%rename(date='weekdays(as.Date(Date$date, "%Y-%m-%d"))')

# Creating Months
Month<-as.data.frame(months(as.Date(Date$date,'%Y-%m-%d')))
Month<-Month%>%rename(month=`months(as.Date(Date$date, "%Y-%m-%d"))`)

# Creating Week
Week<-as.data.frame(as.POSIXlt(Date$date)$wday)
Week<-Week%>%rename(week=`as.POSIXlt(Date$date)$wday`)

# Combining
Data2<-data%>%select(ID,`Reference / Name`:`Unsubscribe Rate`)

Data2<-cbind(Date2,Time, Month,Data2)

Data2<-Data2%>%select(ID,date:month,`Reference / Name`:`Unsubscribe Rate`)

```



```{r,echo=FALSE}
#Frequency
freq(Data2$`Reference / Name`)
freq(Data2$`From Firm?`)
freq(Data2$`e-Mail Type`)
freq(Data2$`Product Name(s) (if applicable)`)
freq(Data2$`Subscription?`)
freq(Data2$`Blast Message?`)
freq(Data2$`Distribution Partner Specific?`)
freq(Data2$`Preferred Partner?`)
freq(Data2$`Producers Only`)
freq(Data2$`Prospects Only`)
```

```{r}
#Outliers
Out.Audience.Size<-boxplot.stats(Data2$`Audience Size`)$out
Out.Open.Rate<-boxplot.stats(Data2$`Open Rate`)$out
Out.Clickthrough.Rate<-boxplot.stats(Data2$`Clickthrough Rate`)$out
Out.Bounce.Rate<-boxplot.stats(Data2$`Bounce Rate`)$out
Out.Unsubscibe.Rate<-boxplot.stats(Data2$`Unsubscribe Rate`)$out

#Boxplot
ggplot(Data2) +
  aes(x = "", y = `Open Rate`) +
  geom_boxplot(fill = "#0c4c8a") +
  theme_minimal()

ggplot(Data2) +
  aes(x = "", y = `Clickthrough Rate`) +
  geom_boxplot(fill = "#0c4c8a") +
  theme_minimal()

ggplot(Data2) +
  aes(x = "", y = `Bounce Rate`) +
  geom_boxplot(fill = "#0c4c8a") +
  theme_minimal()

ggplot(Data2) +
  aes(x = "", y = `Unsubscribe Rate`) +
  geom_boxplot(fill = "#0c4c8a") +
  theme_minimal()
```

```{r}
# QQplot
qq.Audience.Size <- qqPlot(Data2$Audience.Size)
qq.Open.Rate<-qqPlot(Data2$`Open Rate`)
qq.Clickthrough.Rate<-qqPlot(Data2$`Clickthrough Rate`)
qq.Bounce.Rate<-qqPlot(Data2$`Bounce Rate`)
qq.Unsubscribe.Rate<-qqPlot(Data2$`Unsubscribe Rate`)


```


```{r}
#Desciptives: mean of DVs at each level of each categorical IV
#From.Firm
data%>%group_by(`From.Firm`)%>%
  summarise(open_mean = mean(`Open.Rate`),
            clickthrough_mean = mean(`Clickthrought.Rate`),
            bounce_mean = mean(`Bounce.Rate`),
            unsubscribe_mean = mean(`Unsubscribe.Rate`),
            n())

#email.Type
data%>%group_by(`email.Type`)%>%
  summarise(open_mean = mean(`Open.Rate`),
            clickthrough_mean = mean(`Clickthrought.Rate`),
            bounce_mean = mean(`Bounce.Rate`),
            unsubscribe_mean = mean(`Unsubscribe.Rate`),
            n())

#Product.Name
data%>%group_by(`Product.Name`)%>%
  summarise(open_mean = mean(`Open.Rate`),
            clickthrough_mean = mean(`Clickthrought.Rate`),
            bounce_mean = mean(`Bounce.Rate`),
            unsubscribe_mean = mean(`Unsubscribe.Rate`),
            n())

#Subscription
data%>%group_by(`Subscription`)%>%
  summarise(open_mean = mean(`Open.Rate`),
            clickthrough_mean = mean(`Clickthrought.Rate`),
            bounce_mean = mean(`Bounce.Rate`),
            unsubscribe_mean = mean(`Unsubscribe.Rate`),
            n())

# Blast Message

```




```{r, echo=FALSE}

##Blast Message Group Means


Blast_Open <- as.data.frame(data%>%group_by(`Blast Message?`)%>%
 summarise(mean=mean(`Open Rate`),n()))

Blast_Clickthrough <- data%>%group_by(`Blast Message?`)%>%
   summarise(mean=mean(`Clickthrough Rate`),n())

Blast_Bounce <- data%>%group_by(`Blast Message?`)%>%
  summarise(mean=mean(`Bounce Rate`),n())

Blast_Unsubscribe <- data%>%group_by(`Blast Message?`)%>%
  summarise(mean=mean(`Unsubscribe Rate`),n())

Blast.Group <- as.data.frame(c(Blast_Open[,1:2],Blast_Clickthrough[,2], Blast_Bounce[,2], Blast_Unsubscribe[,2:3]))

rename(Blast.Group, "Open Rate" = "mean")
```
```{r, echo=FALSE}

#"Distribution Partner Specific?" Means

Distribution_Open <- as.data.frame(data%>%group_by(`Distribution Partner Specific?`)%>%
 summarise(mean=mean(`Open Rate`),n()))

Distribution_Clickthrough <- data%>%group_by(`Distribution Partner Specific?`)%>%
   summarise(mean=mean(`Clickthrough Rate`),n())

Distribution_Bounce <- data%>%group_by(`Distribution Partner Specific?`)%>%
  summarise(mean=mean(`Bounce Rate`),n())

Distribution_Unsubscribe <- data%>%group_by(`Distribution Partner Specific?`)%>%
  summarise(mean=mean(`Unsubscribe Rate`),n())

Distribution.Group <- as.data.frame(c(Distribution_Open[,1:2],Distribution_Clickthrough[,2], Distribution_Bounce[,2], Distribution_Unsubscribe[,2:3]))
```

```{r, echo=FALSE}

# Preferred Partner Means

Preferred.Partner_Open <- as.data.frame(data%>%group_by(`Preferred Partner?`)%>%
 summarise(mean=mean(`Open Rate`),n()))

Preferred.Partner_Clickthrough <- data%>%group_by(`Preferred Partner?`)%>%
   summarise(mean=mean(`Clickthrough Rate`),n())

Preferred.Partner_Bounce <- data%>%group_by(`Preferred Partner?`)%>%
  summarise(mean=mean(`Bounce Rate`),n())

Preferred.Partner_Unsubscribe <- data%>%group_by(`Preferred Partner?`)%>%
  summarise(mean=mean(`Unsubscribe Rate`),n())

Preferred.Partner.Group <- as.data.frame(c(Preferred.Partner_Open[,1:2],Preferred.Partner_Clickthrough[,2], Preferred.Partner_Bounce[,2], Preferred.Partner_Unsubscribe[,2:3]))
```

```{r,echo=FALSE}
#Producers Only Means

Producers_Open <- as.data.frame(data%>%group_by(`Producers Only`)%>%
 summarise(mean=mean(`Open Rate`),n()))

Producers_Clickthrough <- data%>%group_by(`Producers Only`)%>%
   summarise(mean=mean(`Clickthrough Rate`),n())

Producers_Bounce <- data%>%group_by(`Producers Only`)%>%
  summarise(mean=mean(`Bounce Rate`),n())

Producers_Unsubscribe <- data%>%group_by(`Producers Only`)%>%
  summarise(mean=mean(`Unsubscribe Rate`),n())

Producers.Group <- as.data.frame(c(Producers_Open[,1:2],Producers_Clickthrough[,2], Producers_Bounce[,2], Producers_Unsubscribe[,2:3]))

```

```{r,echo=FALSE}
#Prospects Means

Prospects_Open <- as.data.frame(data%>%group_by(`Prospects Only`)%>%
 summarise(mean=mean(`Open Rate`),n()))

Prospects_Clickthrough <- data%>%group_by(`Prospects Only`)%>%
   summarise(mean=mean(`Clickthrough Rate`),n())

Prospects_Bounce <- data%>%group_by(`Prospects Only`)%>%
  summarise(mean=mean(`Bounce Rate`),n())

Prospects_Unsubscribe <- data%>%group_by(`Prospects Only`)%>%
  summarise(mean=mean(`Unsubscribe Rate`),n())

Prospects.Group <- as.data.frame(c(Prospects_Open[,1:2],Prospects_Clickthrough[,2], Prospects_Bounce[,2], Prospects_Unsubscribe[,2:3]))

```


```{r}


# Plot
ggplot(Plt1Data, aes(Time, Weekday, fill = `Open Rate`)) +
  geom_tile(colour = "white") +
  facet_grid(Weekmonth~Month) +
  scale_fill_gradient(low="red", high="green") +
  labs(x="Time of Day",
       y="",
       title = "Time-Series Calendar Heatmap",
       subtitle="Email Open Rate",
       fill="Close")
#Plot 2
ggplot(Plt1Data, aes(Time, Weekday, fill = `Clickthrough Rate`)) +
  geom_tile(colour = "white") +
  facet_grid(Weekmonth~Month) +
  scale_fill_gradient(low="red", high="green") +
  labs(x="Time of Day",
       y="",
       title = "Time-Series Calendar Heatmap",
       subtitle="Email Clickthrough Rate",
       fill="Close")

#Plot 3
ggplot(Plt1Data, aes(Time, Weekday, fill = `Bounce Rate`)) +
  geom_tile(colour = "white") +
  facet_grid(Weekmonth~Month) +
  scale_fill_gradient(low="red", high="green") +
  labs(x="Time of Day",
       y="",
       title = "Time-Series Calendar Heatmap",
       subtitle="Email Bounce Rate",
       fill="Close")

#Plot 4
ggplot(Plt1Data, aes(Time, Weekday, fill = `Unsubscribe Rate`)) +
  geom_tile(colour = "white") +
  facet_grid(Weekmonth~Month) +
  scale_fill_gradient(low="red", high="green") +
  labs(x="Time of Day",
       y="",
       title = "Time-Series Calendar Heatmap",
       subtitle="Email Unsubscribe Rate",
       fill="Close")

#Plot 5
open <- c(df$Open.Rate)
click <- c(df$Clickthrough.Rate)
bounce <- c(df$Bounce.Rate)
unsub <- c(df$Unsubscribe.Rate)
aum <- c(df$Audience.Size)
data<- data.frame(open,click,bounce,unsub,aum)

library(ggplot2)
library(hrbrthemes)
library(dplyr)
library(tidyr)
library(viridis)
data<-read.csv("C:/Users/cmnot/Documents/Naissance/Plt2Data.csv")
#Interaction<-data$?..Interaction
#Rate<-data$Rate
#AUM<-data$AUM
#data<- data.frame(Interaction,Rate,AUM)
p <- ggplot(data=data, aes(x=Rate, group=Interaction, fill=Interaction)) + geom_density(adjust=1.5, alpha=.4) + theme_ipsum()
p
#Could use standardized x-axis

#Plot 6
library(ggplot2)
ggplot(data=data,aes(x=AUM,y=Rate,fill=factor(Interaction)))+
  geom_bar(stat="identity",position="dodge")+
  scale_fill_discrete(name="Interaction",
                      breaks=c(1, 2, 3, 4),
                      labels=c("Open", "Click", "Bounce", "Unsub"))+
  xlab("AUM")+ylab("Rate")
```


