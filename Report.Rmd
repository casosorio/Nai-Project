---
title: "Naissance"
author: "Eagle IO"
date: "1/14/2021"
output: pdf_document
---

```{r,echo=FALSE,include=FALSE}
library(readxl)
library(tidyverse)
library(tidymodels)
library(class)
library(kknn)
library(stringr)
library(psych)
library(caret)
library(ggplot2)
library(descr)
library(janitor)
library(CGPfunctions)
library(summarytools)
library(dplyr)
library(ggpubr)


# Remember to change the location to your computer or flashdrive. 
data <- read_excel("E:/Montclair State University/EagleIO/Naissance/Naissance e-Mail Metrics Pilot - Data Template.xlsx")
```

```{r, include=FALSE}
# Data Cleaning
Date<-as.data.frame(substr(data$`Send Time`,1,10))
Time<-as.data.frame(substr(data$`Send Time`,12,19))

Date<-Date%>%rename(date="substr(data$`Send Time`, 1, 10)")
Time<-Time%>%rename(time="substr(data$`Send Time`, 12, 19)")

Date$date<-gsub("2021","2020",Date$date)

# Creating Days
Date2<-as.data.frame(weekdays(as.Date(Date$date,'%Y-%m-%d')))
Date2<-Date2%>%rename(date='weekdays(as.Date(Date$date, "%Y-%m-%d"))')

# Creating Months
Month<-as.data.frame(months(as.Date(Date$date,'%Y-%m-%d')))
Month<-Month%>%rename(month=`months(as.Date(Date$date, "%Y-%m-%d"))`)

# Creating Week
Date$date<-as.Date(Date$date)
Week<-as.data.frame(stringi::stri_datetime_fields(Date$date)$WeekOfMonth)
Week<-Week%>%rename(week="stringi::stri_datetime_fields(Date$date)$WeekOfMonth")
  
# Combining
Data2<-data%>%select(ID,`Reference / Name`:`Unsubscribe Rate`)

Data2<-cbind(Date2,Time, Month,Week,Data2)

Data2<-Data2%>%select(ID,date:week,`Reference / Name`:`Unsubscribe Rate`)

```

# Descriptive Statisitics
```{r}
# Basic Descriptives
summary(Data2)

# Histogram
ggplot(Data2) +
  aes(x = `Open Rate`) +
  geom_histogram(bins = 30L, fill = "#0c4c8a") +
  theme_minimal()

ggplot(Data2) +
  aes(x = `Clickthrough Rate`) +
  geom_histogram(bins = 30L, fill = "#0c4c8a") +
  theme_minimal()

ggplot(Data2) +
  aes(x = `Bounce Rate`) +
  geom_histogram(bins = 30L, fill = "#0c4c8a") +
  theme_minimal()

ggplot(Data2) +
  aes(x = `Unsubscribe Rate`) +
  geom_histogram(bins = 30L, fill = "#0c4c8a") +
  theme_minimal()


```



```{r}
#Assumption checks
## Denisity Plot
ggdensity(Data2$`Open Rate`,
          main= "Density plot of Open Rate",
          xlab= "Open Rate")

ggdensity(Data2$`Clickthrough Rate`,
          main= "Density plot of Clickthrough Rate",
          xlab= "Clickthrough Rate")

ggdensity(Data2$`Bounce Rate`,
          main= "Density plot of Bounce Rate",
          xlab= "Bounce Rate")

ggdensity(Data2$`Unsubscribe Rate`,
          main= "Density plot of Unsubscribe Rate",
          xlab= "Unsubscribe Rate")

##Q-Q plot
ggqqplot(Data2$`Open Rate`)
ggqqplot(Data2$`Clickthrough Rate`)
ggqqplot(Data2$`Bounce Rate`)
ggqqplot(Data2$`Unsubscribe Rate`)

##Shapiro-Test Wilks
shapiro.test(Data2$`Open Rate`)
shapiro.test(Data2$`Clickthrough Rate`)
shapiro.test(Data2$`Bounce Rate`)
shapiro.test(Data2$`Unsubscribe Rate`)


#Outliers
##  Boxplot

ggplot(Data2) +
  aes(x = "", y = `Open Rate`) +
  geom_boxplot(fill = "#0c4c8a") +
  theme_minimal()

ggplot(Data2) +
  aes(x = "", y = `Clickthrough Rate`) +
  geom_boxplot(fill = "#0c4c8a") +
  theme_minimal()

ggplot(Data2) +
  aes(x = "", y = `Bounce Rate`) +
  geom_boxplot(fill = "#0c4c8a") +
  theme_minimal()

ggplot(Data2) +
  aes(x = "", y = `Unsubscribe Rate`) +
  geom_boxplot(fill = "#0c4c8a") +
  theme_minimal()

# Finding specific outlies
boxplot.stats(Data2$`Open Rate`)$out
boxplot.stats(Data2$`Clickthrough Rate`)$out
boxplot.stats(Data2$`Bounce Rate`)$out
boxplot.stats(Data2$`Unsubscribe Rate`)$out


```


```{r}
#Quantile
quantile(Data2$`Open Rate`,na.rm = TRUE)
quantile(Data2$`Clickthrough Rate`, na.rm = TRUE)
quantile(Data2$`Bounce Rate`, na.rm=TRUE)
quantile(Data2$`Unsubscribe Rate`, na.rm = TRUE)

```


## Contigency Tables

```{r,echo=FALSE}
tabyl(Data2,date,`Open Rate`)%>%
  adorn_percentages("row")%>%
  adorn_pct_formatting(digits = 1)

CGPfunctions::PlotXTabs(Data2,`Open Rate`,date)


```



## Regression 

```{r}

```

## Cluster Analysis
```{r}
# Creating a function to normalize the data
norm_func<-function(x){(x-min(x))/max(x)-min(x)}
Norm_Data<-as.data.frame(lapply(Data2[,9], norm_func))

df.split<-initial_split(Data2,prop=.7,strata=`Open Rate`)

df.train<-training(df.split)
df.test<-testing(df.split)

```


